---
description: Initialize AI context for a project. Auto-detects tech stack, architecture, and conventions. Generates project-context SKILL.md.
---

// turbo-all

## Core Principle: Never Override Knowledge

All existing knowledge has value. Scan results only SUPPLEMENT, never replace.
If scan finds a conflict (e.g. version mismatch), show BOTH values and ask user.

## Merge Rules

| Section Marker                     | Behavior                                                                                                       |
| ---------------------------------- | -------------------------------------------------------------------------------------------------------------- |
| `<!-- AUTO-GENERATED -->`          | Merge: add new items, update versions. NEVER delete existing items unless module is truly removed from project |
| `<!-- PRESERVED -->` / Human Notes | Never touch. Skip entirely                                                                                     |
| Sections without marker            | Show diff, ask user — could be human-added knowledge                                                           |
| New sections from scan             | Append at end of file, mark `<!-- AUTO-GENERATED -->`                                                          |

## Steps

1. Scan project → generate SKILL.md content into buffer (do NOT write yet)

2. If `.agent/skills/project-context/SKILL.md` already exists:
   a. Read existing file
   b. Compare buffer vs existing, section by section
   c. Show DIFF to user:
   - "Section X: no changes"
   - "Section Y: 3 new items added, 0 removed"
   - "Section Z (human-written): PRESERVED, not touched"
     d. Ask user: "Apply these changes? [Y / n / selective]"
     e. Only write after explicit confirmation

3. If SKILL.md doesn't exist:
   a. Generate fresh from buffer
   b. Show preview to user for review
   c. Write after confirmation

4. Scan ENTIRE project root (not just src/):
   - `package.json` / `pyproject.toml` / `go.mod` → tech stack + versions
   - `tsconfig.json` / `.eslintrc` / `.prettierrc` → code conventions
   - `docker-compose.yml` / `Dockerfile` / `k8s/` → infrastructure
   - `.github/workflows/` / `.gitlab-ci.yml` → CI/CD pipeline
   - `migrations/` / `prisma/` / `drizzle/` → database
   - `.env.example` → environment variables
   - `test/` / `e2e/` / `__tests__/` / `*.spec.ts` → test structure
   - `docs/` → existing documentation

5. Detect project type:
   - `*.module.ts` in src/ → NestJS
   - `app/` or `pages/` → Next.js
   - `src/screens/` or `app.json` with expo → React Native / Expo
   - `packages/` or `apps/` → Monorepo
   - `manage.py` → Django
   - `go.mod` → Go
   - None of above → Generic

6. Scan modules and classify each:
   - Has `domain/` + `application/` → **DDD**
   - Has nested `modules/` inside → **Composite**
   - Everything else → **Legacy**
     Build a Module Classification table with: name, pattern, file count, key entry point

7. Detect proactive quality check patterns specific to this project:
   - ORM usage → flag N+1 query risks
   - Entity naming vs DB table naming → flag potential mismatches
   - Circular dependency risks between modules
   - Any `any` types in TypeScript
   - Missing test coverage patterns

8. Generate `.agent/skills/project-context/SKILL.md` using enriched template:

   ```
   ---
   name: project-context
   description: >
     Auto-generated project context for <project-name>.
     Helps AI understand tech stack, architecture, and conventions.
     Generated by /init-project on <date>.
   ---

   # Project Context

   ## Overview
   <!-- AUTO-GENERATED -->
   - **Name**: <from package.json>
   - **Type**: <Backend API | Full-stack | Mobile App | Library | Monorepo>
   - **Framework**: <NestJS 10 | Next.js 14 | Express | etc.>
   - **Language**: <TypeScript 5.x | JavaScript | Python 3.x>

   ## Tech Stack
   <!-- AUTO-GENERATED -->
   | Category | Technology | Version |
   |----------|-----------|---------|
   | Runtime | Node.js | 20.x |
   | ... | ... | ... |

   ## Module Classification
   <!-- AUTO-GENERATED — refreshed by /init-project -->
   | Module | Pattern | Files | Key Entry Point | Notes |
   |--------|---------|-------|-----------------|-------|
   | payment | DDD | 45 | payment.module.ts | Stripe integration |
   | auth | Legacy | 12 | auth.module.ts | — |
   | billing | Composite | 30 | billing.module.ts | Has sub-modules: invoice, subscription |

   ## Architecture
   <!-- AUTO-GENERATED -->
   - **Pattern**: <detected pattern>
   - **Module location**: <detected path>
   - **Layer order**: Domain → Application → Infrastructure → Presentation

   ## Conventions
   <!-- AUTO-GENERATED -->
   - **Naming**: <detected from codebase>
   - **Testing**: <detected framework + patterns>
   - **Git**: <detected from existing commits>

   ## Proactive Quality Checks
   <!-- AUTO-GENERATED — refreshed by /init-project -->
   When working in this project, always check:
   - [ ] N+1 queries: <ORM-specific guidance>
   - [ ] Entity-DB naming: <specific mismatches found>
   - [ ] Circular deps: <modules at risk>
   - [ ] Type safety: <areas with weak typing>

   ## Key Entry Points
   <!-- AUTO-GENERATED -->
   - **Main**: <detected>
   - **Config**: <detected>

   ## Human Notes
   <!-- PRESERVED — not overwritten by /init-project update mode -->
   <space for human to add business-specific notes, domain knowledge, etc.>
   ```

9. Generate `.agent/skills/knowledge-router/SKILL.md`:

   ```
   ---
   name: knowledge-router
   description: >
     Routes knowledge to correct locations after tasks.
     Auto-generated by /init-project.
   ---

   # Knowledge Router

   ## After every task, evaluate: "Is there knowledge worth preserving?"

   ## Routing Rules
   | Knowledge Type | Target Location | Example |
   |---------------|-----------------|---------|
   | Business decisions | `docs/<module>/decisions/` | "Why we chose Stripe over PayPal" |
   | Patterns/conventions | `project-context SKILL.md` | "All DTOs use class-validator" |
   | Repeatable processes | `.agent/workflows/` | "How to deploy to staging" |
   | Lessons learned | `tasks/lessons.md` (session) | "N+1 query bug in payment module" |
   | Permanent lessons | `docs/<module>/decisions/` | "Always use LEFT JOIN for optional relations" |

   ## Module → Docs Mapping
   <!-- AUTO-GENERATED -->
   | Module | Docs Path |
   |--------|-----------|
   | <module-name> | `docs/<module-name>/decisions/` |
   ```

10. Create scaffolding if not exists:
    - `tasks/todo.md` — empty checklist
    - `tasks/lessons.md` — empty lessons file
    - `docs/` directory

11. IMPORTANT: Do NOT copy global skills into `.agent/skills/`.
    `.agent/skills/` is for project-specific skills ONLY.
    Global skills live in `~/.agents/skills/` (managed by setup script).

12. Report summary to user:
    - Project type detected
    - Module classification table
    - Quality checks found
    - Files created/updated
    - Suggest: run `/scan-modules` for deep module analysis

## Staleness Check (for other workflows)

Other workflows (`/plan`, `/debug`, `/review`) should add this as Step 0:

```
0. Check project-context SKILL.md staleness:
   - Missing? → Suggest: "Run /init-project first"
   - Older than 30 days? → Suggest: "Run /init-project to refresh"
   - >50 commits since last update? → Suggest: "Run /init-project --update"
```
